from invenio_records.systemfields import ConstantField, RelationsField
from invenio_records_resources.records.systemfields import IndexField,

from invenio_records_resources.records.systemfields.pid import PIDField, PIDFieldContext
from invenio_pidstore.providers.recordid_v2 import RecordIdProviderV2

{% for b in current_model.record_bases %}
from {{ b|package_name }} import {{ b|base_name }}
{% endfor %}
from {{ current_model.record_metadata_class|package_name }} import {{ current_model.record_metadata_class|base_name }}
from {{ current_model.record_dumper_class|package_name }} import {{ current_model.record_dumper_class|base_name }}

{% for rel in invenio_relations %}
{% for imp in rel.imports or [] %}
import {{ imp }}
{% endfor %}
{% endfor %}
{% if invenio_relations %}
from invenio_records.dumpers.relations import RelationDumperExt
{% endif %}

class {{ current_model.record_class|base_name }}({% for b in current_model.record_bases %}{{ b|base_name }}{{ ", " if not loop.last else "" }} {% endfor %}):
    model_cls = {{ current_model.record_metadata_class|base_name }}
    schema = ConstantField("$schema", "{{ current_model.schema_server }}{{ current_model.schema_name }}")
    index = IndexField("{{ current_model.index_name }}")
{% if current_model.generate_record_pid_field %}
    pid = PIDField(
        create=True,
        provider=RecordIdProviderV2,
        context_cls = PIDFieldContext
    )
{% endif %}
    dumper_extensions = [
        {%- for ext in current_model.record_dumper_extensions %}{{ ext }}{% if not loop.last %}, {% endif %}{% endfor -%}
        {% if invenio_relations %}
            RelationDumperExt("relations"),
        {% endif %}
    ]
    dumper = {{ current_model.record_dumper_class|base_name }}(extensions=dumper_extensions)

    {% if invenio_relations %}
    relations = RelationsField(
        {% for rel in invenio_relations %}
        {{ rel.name }}={{ rel.type }}(
            {% for param in rel.params %}{{ param }},
            {% endfor %}
        ),
        {% endfor %}
    )
    {% endif %}

{{ current_model.invenio_record_extra_code }}