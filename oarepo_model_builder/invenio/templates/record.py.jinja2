from invenio_records.systemfields import ConstantField
from invenio_records_resources.records.systemfields import IndexField

{{ vars.pid|generate_import('provider-class') }}
{{ vars.pid.imports|generate_import }}
{{ vars.record_metadata|generate_import }}
{{ vars.record_dumper|generate_import }}
{{ vars.record.imports|generate_import }}

class {{ vars.record|class_header }}:
    model_cls = {{ vars.record_metadata.class|base_name }}
{% if vars.json_schema.name %}
    schema = ConstantField("$schema", "{{ settings.schema_server }}{{ vars.json_schema.name }}")
{% endif %}
{% if vars.mapping.index %}
    index = IndexField("{{ vars.mapping.index }}")
{% endif %}
{% if not vars.pid.skip %}
    pid = {{ vars.pid.field_class }}(
        provider={{ vars.pid.provider_class|base_name }},
        context_cls={{ vars.pid.context_class }}{% if vars.pid.field_args %},
        {% for arg in vars.pid.field_args %}{{ arg }}{{ ", " if not loop.last else "" }}{% endfor %}
    {% endif %}
    )
{% endif %}
    dumper_extensions = [
        {%- for ext in vars.record.dumper_extensions %}{{ ext }}{% if not loop.last %}, {% endif %}{% endfor -%}
    ]
    dumper = {{ vars.record_dumper.class|base_name }}(extensions=dumper_extensions)

{{ vars.record.extra_code }}